query GetBacktests($first: Int, $after: Cursor, $where: BacktestWhereInput) {
  backtests(first: $first, after: $after, where: $where) {
    edges {
      node {
        id
        status
        result
        errorMessage
        createdAt
        updatedAt
        completedAt
        strategy {
          id
          name
          config
        }
        runner {
          id
          name
          type
        }
      }
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
    totalCount
  }
}

query GetBacktest($id: ID!) {
  backtests(where: {id: $id}, first: 1) {
    edges {
      node {
        id
        status
        result
        logs
        errorMessage
        createdAt
        updatedAt
        completedAt
        strategy {
          id
          name
          description
        }
        runner {
          id
          name
          type
        }
      }
    }
  }
}

query GetBacktestOptions($ownerID: String) {
  botRunners(first: 50, where: { ownerID: $ownerID }) {
    edges {
      node {
        id
        name
        type
      }
    }
  }
}

query SearchStrategies($search: String, $ownerID: String, $first: Int) {
  strategies(
    first: $first
    where: {
      ownerID: $ownerID
      nameContainsFold: $search
    }
  ) {
    edges {
      node {
        id
        name
        versionNumber
        isLatest
        config
      }
    }
  }
}

query GetStrategyById($id: ID!) {
  strategies(first: 1, where: { id: $id }) {
    edges {
      node {
        id
        name
        versionNumber
        isLatest
        config
      }
    }
  }
}

mutation RunBacktest($input: CreateBacktestInput!) {
  runBacktest(input: $input) {
    id
    status
    createdAt
    strategy {
      id
      name
      versionNumber
    }
  }
}

mutation StopBacktest($id: ID!) {
  stopBacktest(id: $id) {
    id
    status
  }
}

mutation DeleteBacktest($id: ID!) {
  deleteBacktest(id: $id)
}

# Subscription for real-time backtest progress updates
subscription BacktestProgress($backtestId: ID!) {
  backtestProgress(backtestId: $backtestId) {
    id
    status
    result
    logs
    errorMessage
    createdAt
    updatedAt
    completedAt
    strategy {
      id
      name
    }
  }
}