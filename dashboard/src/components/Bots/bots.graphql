query GetBots($first: Int, $after: Cursor, $where: BotWhereInput) {
  bots(first: $first, after: $after, where: $where) {
    edges {
      node {
        id
        name
        status
        mode
        freqtradeVersion
        lastSeenAt
        errorMessage
        createdAt
        config
        ownerID
        public
        exchange {
          id
          name
        }
        strategy {
          id
          name
        }
        runner {
          id
          name
          type
        }
      }
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
    totalCount
  }
}

query GetBot($id: ID!) {
  bots(where: {id: $id}, first: 1) {
    edges {
      node {
      id
      name
      status
      mode
      freqtradeVersion
      lastSeenAt
      errorMessage
      createdAt
      updatedAt
      config
      exchange {
        id
        name
      }
      strategy {
        id
        name
        description
      }
      runner {
        id
        name
        type
      }
      metrics {
        id
        profitClosedCoin
        profitClosedPercent
        profitAllCoin
        profitAllPercent
        tradeCount
        closedTradeCount
        openTradeCount
        winningTrades
        losingTrades
        winrate
        expectancy
        profitFactor
        maxDrawdown
        maxDrawdownAbs
        bestPair
        bestRate
        firstTradeTimestamp
        latestTradeTimestamp
        fetchedAt
        updatedAt
      }
      trades(first: 10) {
        edges {
          node {
            id
            pair
            isOpen
            openDate
            closeDate
            profitAbs
            profitRatio
          }
        }
        totalCount
      }
      }
    }
  }
}

query GetBotRunnerStatus($id: ID!) {
  getBotRunnerStatus(id: $id) {
    botID
    status
    healthy
    lastSeenAt
    cpuUsage
    memoryUsage
    ipAddress
    hostPort
    errorMessage
    createdAt
    startedAt
    stoppedAt
  }
}

mutation CreateBot($input: CreateBotInput!) {
  createBot(input: $input) {
    id
    name
    status
    mode
    freqtradeVersion
    config
  }
}

mutation UpdateBot($id: ID!, $input: UpdateBotInput!) {
  updateBot(id: $id, input: $input) {
    id
    name
    status
    mode
    config
  }
}

mutation DeleteBot($id: ID!) {
  deleteBot(id: $id)
}

mutation StartBot($id: ID!) {
  startBot(id: $id) {
    id
    name
    status
  }
}

mutation StopBot($id: ID!) {
  stopBot(id: $id) {
    id
    name
    status
  }
}

mutation RestartBot($id: ID!) {
  restartBot(id: $id) {
    id
    name
    status
  }
}

mutation SetBotVisibility($id: ID!, $public: Boolean!) {
  setBotVisibility(id: $id, public: $public) {
    id
    name
    public
  }
}

mutation GetFreqtradeToken($botId: ID!) {
  getFreqtradeToken(botId: $botId) {
    apiUrl
    username
    accessToken
    refreshToken
  }
}

# Query to get exchanges for bot creation (filtered by owner)
query GetExchangesForCreate($ownerID: String) {
  exchanges(first: 50, where: { ownerID: $ownerID }) {
    edges {
      node {
        id
        name
      }
    }
  }
}

# Query to get exchanges for bot editing (all accessible)
query GetExchangesForEdit {
  exchanges(first: 50) {
    edges {
      node {
        id
        name
      }
    }
  }
}

# Bot resource usage history query - for usage charts
query GetBotUsageHistory($botID: ID!, $start: Time!, $end: Time!) {
  botUsageHistory(botID: $botID, start: $start, end: $end) {
    id
    resourceType
    resourceID
    granularity
    bucketStart
    bucketEnd
    cpuCoreSeconds
    cpuAvgPercent
    cpuMaxPercent
    memoryGBSeconds
    memoryAvgBytes
    memoryMaxBytes
    networkRxBytes
    networkTxBytes
    blockReadBytes
    blockWriteBytes
    sampleCount
  }
}

# Subscription for real-time bot status updates (detail view)
subscription BotStatusChanged($botId: ID!) {
  botStatusChanged(botId: $botId) {
    id
    name
    status
    mode
    lastSeenAt
    errorMessage
    metrics {
      id
      profitClosedCoin
      profitClosedPercent
      profitAllCoin
      profitAllPercent
      tradeCount
      closedTradeCount
      openTradeCount
      winningTrades
      losingTrades
      winrate
      expectancy
      profitFactor
      maxDrawdown
      maxDrawdownAbs
      bestPair
      bestRate
      fetchedAt
      updatedAt
    }
  }
}

# Subscription for all bot changes in an organization (list view)
subscription BotChanged($ownerId: String!) {
  botChanged(ownerId: $ownerId) {
    id
    name
    status
    mode
    lastSeenAt
    errorMessage
    exchange {
      id
      name
    }
    strategy {
      id
      name
    }
    runner {
      id
      name
      type
    }
  }
}
